name: Generate Android Keystore

on:
  workflow_dispatch:
    inputs:
      keystore_password:
        description: 'Keystore password'
        required: true
        default: 'RecitativosCCB2025!'
      key_password:
        description: 'Key password'
        required: true
        default: 'RecitativosCCB2025!'
      key_alias:
        description: 'Key alias'
        required: true
        default: 'recitativos-release'

jobs:
  generate-keystore:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        
    - name: Generate keystore
      run: |
        # Create android directory
        mkdir -p android
        
        # Generate keystore
        keytool -genkeypair -v -keystore android/recitativos-release.keystore \
          -alias "${{ github.event.inputs.key_alias }}" \
          -keyalg RSA \
          -keysize 2048 \
          -validity 25000 \
          -storepass "${{ github.event.inputs.keystore_password }}" \
          -keypass "${{ github.event.inputs.key_password }}" \
          -dname "CN=Recitativos CCB, OU=Mobile Development, O=Vineyard Technologies, L=Unknown, ST=Unknown, C=US"
        
        echo "‚úÖ Keystore created successfully!"
        
    - name: Convert to base64 and output secrets
      run: |
        # Convert keystore to base64
        base64_keystore=$(base64 -w 0 android/recitativos-release.keystore)
        
        echo "üîê GitHub Secrets to add:"
        echo "========================"
        echo ""
        echo "ANDROID_KEYSTORE_BASE64:"
        echo "$base64_keystore"
        echo ""
        echo "KEYSTORE_PASSWORD:"
        echo "${{ github.event.inputs.keystore_password }}"
        echo ""
        echo "KEY_PASSWORD:"
        echo "${{ github.event.inputs.key_password }}"
        echo ""
        echo "KEY_ALIAS:"
        echo "${{ github.event.inputs.key_alias }}"
        echo ""
        echo "‚ö†Ô∏è  Copy these values to your repository secrets!"
        
    - name: Upload keystore artifact
      uses: actions/upload-artifact@v4
      with:
        name: android-keystore
        path: android/recitativos-release.keystore
        retention-days: 7
